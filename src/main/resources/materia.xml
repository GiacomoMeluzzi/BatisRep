<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="lepackage.mappers.MateriaMapper">
	
	<select id="findMateriaConUtentiById" resultMap="materiaUtentiMap"
	>select m.id, m.nome as materia_nome, u.username as username
		from materie m
		left join utente_materia t on t.materia_id = m.id
		left join utenti u on t.utente_id = u.id
		where m.id = #{id}
	</select>
	
	<insert id="insertMateriaEUtente" parameterType="Utente">
	    insert into utente_materia (utente_id, materia_id)
	    values
	    <foreach collection="materieId" item="materiaId" separator=",">
	        (#{id}, #{materiaId})
	    </foreach>
	</insert>
	
	<!-- mappe -->
	
	<resultMap id="materiaUtentiMap" type="Materia">
		<id property="id" column="id"/>
	    <result property="nome" column="materia_nome"/>
	    <collection property="utenti" ofType="Utente">
	        <result property="username" column="username"/>
	    </collection>
	</resultMap>
	
</mapper>